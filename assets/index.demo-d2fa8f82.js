import{j as e,r as d}from"./index-02d7365a.js";import{L as D,u as v}from"./Divider-8f7de229.js";import{c as L}from"./helper-cbdea6f1.js";import{L as E}from"./spring-98b1f1f8.js";import{u as H,a as R,p as V,s as p,f as x,c as k,b as j,R as F}from"./LinkCard.module-c6fbc771.js";import"./index-94d83f10.js";import"./env-d87a2338.js";const f=s=>H()?e.jsx(D,{placeholder:e.jsx(U,{}),children:e.jsx(P,{...s})}):null,P=s=>{const{id:t,source:a="self",className:o}=s,[c,l]=d.useState(!0),[i,m]=d.useState(!1),[n,h]=d.useState("about:blank"),[r,C]=d.useState(),N=R(),y=d.useCallback(async u=>{N(n)&&V(u)},[n]),{isValid:w,fetchFn:g}=d.useMemo(()=>M(a,t),[a,t]),$=d.useCallback(async()=>{g&&(l(!0),await g(t,C,h).catch(u=>{console.log("fetch card info error: ",u),m(!0)}),l(!1))},[g,t]),{ref:G}=v({triggerOnce:!0,onChange(u){u&&$()}});if(!w)return null;const S=a==="self"?E:"a";return e.jsxs(S,{href:n,target:a!=="self"?"_blank":"_self",ref:G,className:L(p["card-grid"],(c||i)&&p.skeleton,i&&p.error,o),onClick:y,children:[e.jsxs("span",{className:p.contents,children:[e.jsx("span",{className:p.title,children:r==null?void 0:r.title}),e.jsx("span",{className:p.desc,children:r==null?void 0:r.desc})]}),(c||(r==null?void 0:r.image))&&e.jsx("span",{className:p.image,"data-image":(r==null?void 0:r.image)||"",style:{backgroundImage:r!=null&&r.image?`url(${r.image})`:void 0}})]})},U=()=>e.jsxs("span",{className:L(p["card-grid"],p.skeleton),children:[e.jsxs("span",{className:p.contents,children:[e.jsx("span",{className:p.title}),e.jsx("span",{className:p.desc})]}),e.jsx("span",{className:p.image})]});function M(s,t){const o={"mx-space":b,gh:A,"gh-commit":T,"gh-pr":_,self:b}[s];if(!o)return{isValid:!1,fetchFn:null};const c=o.isValid(t);return{isValid:c,fetchFn:c?o.fetch:null}}const A={isValid:s=>{const t=s.split("/");return t.length===2&&t[0].length>0&&t[1].length>0},fetch:async(s,t,a)=>{const[o,c]=s.split("/");try{const l=await x(`https://api.github.com/repos/${o}/${c}`),i=k(l);t({title:i.name,desc:i.description,image:i.owner.avatarUrl}),a(i.htmlUrl)}catch(l){throw console.error("Error fetching GitHub data:",l),l}}},T={isValid:s=>{const t=s.split("/");return t.length===4&&t.every(a=>a.length>0)&&t[2]==="commit"},fetch:async(s,t,a)=>{var i;const[o,c,,l]=s.split("/");try{const m=await x(`https://api.github.com/repos/${o}/${c}/commits/${l}`),n=k(m);t({title:e.jsx("span",{className:"font-normal",children:n.commit.message.replace(/Signed-off-by:.+/,"")}),desc:e.jsxs("span",{className:"flex items-center space-x-5 font-mono",children:[e.jsxs("span",{className:"text-uk-green-light",children:["+",n.stats.additions]}),e.jsxs("span",{className:"text-uk-red-light",children:["-",n.stats.deletions]}),e.jsx("span",{className:"text-sm",children:n.sha.slice(0,7)}),e.jsxs("span",{className:"text-sm opacity-80",children:[o,"/",c]})]}),image:(i=n.author)==null?void 0:i.avatarUrl}),a(`https://github.com/${o}/${c}/commit/${l}`)}catch(m){throw console.error("Error fetching GitHub commit data:",m),m}}},_={isValid:s=>{const t=s.split("/");return t.length===3&&t.every(a=>a.length>0)},fetch:async(s,t,a)=>{const[o,c,,l]=s.split("/");try{const i=await x(`https://api.github.com/repos/${o}/${c}/pulls/${l}`),m=k(i);t({title:`PR: ${m.title}`,desc:e.jsxs("span",{className:"flex items-center space-x-5 font-mono",children:[e.jsxs("span",{className:"text-uk-green-light",children:["+",m.additions]}),e.jsxs("span",{className:"text-uk-red-light",children:["-",m.deletions]}),e.jsxs("span",{className:"text-sm opacity-80",children:[o,"/",c]})]}),image:m.user.avatarUrl}),a(m.htmlUrl)}catch(i){throw console.error("Error fetching GitHub PR data:",i),i}}},b={isValid:s=>{const[t,...a]=s.split("/");return t!=="posts"&&t!=="notes"?!1:t==="posts"?a.length===2:a.length===1},fetch:async(s,t,a)=>{var l,i,m;const[o,...c]=s.split("/");try{let n={title:"",text:""};if(o==="posts"){const[h,r]=c;n=await j.post.getPost(h,r),a(`/posts/${h}/${r}`)}else if(o==="notes"){const[h]=c;n=await j.note.getNoteById(h),a(`/notes/${h}`)}t({title:n.title,desc:n.summary||`${F(n.text).slice(0,50)}...`,image:n.cover||((l=n.meta)==null?void 0:l.cover)||((m=(i=n.images)==null?void 0:i[0])==null?void 0:m.src)})}catch(n){throw console.error("Error fetching self data:",n),n}}},z=()=>e.jsx(f,{id:"notes/145",source:"mx-space"});z.meta={description:"Show Mix Space Note LinkCard",title:"LinkCard - Mix Space Note"};const B=()=>e.jsx(f,{id:"innei/innei",source:"gh"});B.meta={description:"Show Github Repo LinkCard",title:"LinkCard - GitHub Repo"};const K=()=>e.jsx(f,{id:"notes/1451",source:"mx-space"});K.meta={description:"Error LinkCard",title:"LinkCard - Error"};const O=()=>e.jsx(f,{id:"innei/shiro/132",source:"gh-pr"});O.meta={description:"Show Github PR LinkCard",title:"LinkCard - GitHub PR"};const q=()=>e.jsx(f,{id:"innei/shiro/commit/0bf51cd8cf8457a2666906dea4a333081fc2a2b8",source:"gh-commit"});q.meta={description:"Show Github Commit LinkCard",title:"LinkCard - GitHub Commit"};export{z as LinkCardDemo1,B as LinkCardDemo2,K as LinkCardDemo3,O as LinkCardDemo4,q as LinkCardDemo5};
